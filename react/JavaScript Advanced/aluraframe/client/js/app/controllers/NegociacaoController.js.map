{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_inputQuatidade","_inputData","_inputValor","_listaNegociacoes","_mensagem","_ordemAtual","_service","_init","lista","then","adiciona","negociacoes","catch","console","log","error","texto","setInterval","importarNegociacoes","event","preventDefault","negociacao","_criaNegociacao","cadastra","mensagem","_limpaFormulario","erro","apaga","esvazia","msg","importa","forEach","coluna","inverteOrdem","ordena","a","b","data","textoParaData","value","parseInt","parseFloat","focus","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from '../models/ListaNegociacoes';\r\nimport { Mensagem } from '../models/Mensagem';\r\nimport { Negociacao } from '../models/Negociacao';\r\nimport { NegociacoesView } from '../views/NegociacoesView';\r\nimport { MensagemView } from '../views/MensagemView';\r\nimport { NegociacaoService } from '../services/NegociacaoService';\r\nimport { DateHelper } from '../helpers/DateHelper';\r\nimport { Bind } from '../helpers/Bind';\r\n\r\n\r\nclass NegociacaoController {\r\n\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputQuatidade = $('#quantidade');\r\n    this._inputData = $('#data');\r\n    this._inputValor = $('#valor');\r\n\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacoesView($('#negociacoesView')),\r\n      'adiciona', 'esvazia', 'ordena', 'inverteOrdem'\r\n    );\r\n\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView($('#mensagemView')),\r\n      'texto'\r\n    );\r\n\r\n    this._ordemAtual = '';\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  _init() {\r\n    this._service.lista()\r\n    .then(negociacoes => this._listaNegociacoes.adiciona(negociacoes))\r\n    .catch( error => {\r\n      console.log(error);\r\n      this._mensagem.texto = error;\r\n    });\r\n\r\n    setInterval(() => {\r\n      this.importarNegociacoes()\r\n    }, 3000);\r\n  }\r\n\r\n  adiciona(event) {\r\n    event.preventDefault();\r\n    let negociacao = this._criaNegociacao();\r\n\r\n    this._service.cadastra(negociacao)\r\n        .then(mensagem => {\r\n          console.log(this);\r\n            this._listaNegociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = mensagem; \r\n            this._limpaFormulario();  \r\n        }).catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  apaga() {\r\n      this._service.apaga()\r\n      .then(msg => {\r\n        this._listaNegociacoes.esvazia();\r\n        this._mensagem.texto = msg;\r\n      })\r\n      .catch(error => {\r\n        this._mensagem.texto = error;\r\n      });\r\n  }\r\n\r\n  importarNegociacoes() {\r\n    this._service.importa(this._listaNegociacoes.negociacoes)\r\n    .then((negociacoes) =>  {\r\n      negociacoes.forEach(negociacao => (this._listaNegociacoes.adiciona(negociacao)));\r\n      this._mensagem.texto = 'Negociações da semana importadas com sucesso';\r\n    }).catch((error) => {\r\n      this._mensagem.texto = error;\r\n    });\r\n\r\n  }\r\n\r\n  ordena(coluna) {\r\n    if (this._ordemAtual == coluna) {\r\n      this._listaNegociacoes.inverteOrdem();\r\n    } else {\r\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n    }\r\n    this._ordemAtual = coluna;\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    let data = DateHelper.textoParaData(this._inputData.value);\r\n\r\n    return new Negociacao(\r\n      data,\r\n      parseInt(this._inputQuatidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = '';\r\n    this._inputQuatidade.value = 1;\r\n    this._inputValor.value = 0.0;\r\n\r\n    this._inputData.focus();\r\n  }\r\n\r\n\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\n\r\nexport function currentInstance() {\r\n\r\n    return negociacaoController;\r\n\r\n}"]}