{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputQuatidade","_inputData","_inputValor","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_ordemAtual","_service","NegociacaoService","_init","lista","then","adiciona","negociacoes","catch","console","log","error","texto","setInterval","importarNegociacoes","event","preventDefault","negociacao","_criaNegociacao","cadastra","mensagem","_limpaFormulario","erro","apaga","esvazia","msg","importa","forEach","coluna","inverteOrdem","ordena","a","b","data","DateHelper","textoParaData","value","Negociacao","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\r\n\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputQuatidade = $('#quantidade');\r\n    this._inputData = $('#data');\r\n    this._inputValor = $('#valor');\r\n\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacoesView($('#negociacoesView')),\r\n      'adiciona', 'esvazia', 'ordena', 'inverteOrdem'\r\n    );\r\n\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView($('#mensagemView')),\r\n      'texto'\r\n    );\r\n\r\n    this._ordemAtual = '';\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  _init() {\r\n    this._service.lista()\r\n    .then(negociacoes => this._listaNegociacoes.adiciona(negociacoes))\r\n    .catch( error => {\r\n      console.log(error);\r\n      this._mensagem.texto = error;\r\n    });\r\n\r\n    setInterval(() => {\r\n      this.importarNegociacoes()\r\n    }, 3000);\r\n  }\r\n\r\n  adiciona(event) {\r\n    event.preventDefault();\r\n    let negociacao = this._criaNegociacao();\r\n\r\n    this._service.cadastra(negociacao)\r\n        .then(mensagem => {\r\n          console.log(this);\r\n            this._listaNegociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = mensagem; \r\n            this._limpaFormulario();  \r\n        }).catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  apaga() {\r\n      this._service.apaga()\r\n      .then(msg => {\r\n        this._listaNegociacoes.esvazia();\r\n        this._mensagem.texto = msg;\r\n      })\r\n      .catch(error => {\r\n        this._mensagem.texto = error;\r\n      });\r\n  }\r\n\r\n  importarNegociacoes() {\r\n    this._service.importa(this._listaNegociacoes.negociacoes)\r\n    .then((negociacoes) =>  {\r\n      negociacoes.forEach(negociacao => (this._listaNegociacoes.adiciona(negociacao)));\r\n      this._mensagem.texto = 'Negociações da semana importadas com sucesso';\r\n    }).catch((error) => {\r\n      this._mensagem.texto = error;\r\n    });\r\n\r\n  }\r\n\r\n  ordena(coluna) {\r\n    if (this._ordemAtual == coluna) {\r\n      this._listaNegociacoes.inverteOrdem();\r\n    } else {\r\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n    }\r\n    this._ordemAtual = coluna;\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    let data = DateHelper.textoParaData(this._inputData.value);\r\n\r\n    return new Negociacao(\r\n      data,\r\n      parseInt(this._inputQuatidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = '';\r\n    this._inputQuatidade.value = 1;\r\n    this._inputValor.value = 0.0;\r\n\r\n    this._inputData.focus();\r\n  }\r\n\r\n\r\n}"]}